<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BananaPrep - Problem Details</title>
  <link rel="stylesheet" href="css/styles.css" />
  <link rel="stylesheet" href="css/problem.css" />
  <link rel="stylesheet" href="css/font.css" />
  <!-- Import Source Code Pro font explicitly -->
  <link rel="stylesheet"
    href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:wght@400;500;600;700&display=swap" />
  <!-- Import Font Awesome for modern icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    /* Additional CSS to match the desired UI */
    :root {
      --bg-dark: #1a1a1a;
      --bg-medium: #262626;
      --bg-light: #2d2d2d;
      --border-color: #3e3e3e;
      --text-light: #e6e6e6;
      --text-muted: #b3b3b3;
      --accent-green: #00000000;
      --accent-blue: #3e7bfa;
      --accent-yellow: #ffe135;
      /* BananaPrep yellow */
      --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      --card-shadow-hover: 0 8px 15px rgba(0, 0, 0, 0.2);
      --btn-shadow-hover: 0 5px 10px rgba(0, 0, 0, 0.2);
      --transition-speed: 0.2s;
      --code-font: "Source Code Pro", "Menlo", "Monaco", "Courier New",
        monospace;
    }

    /* Specifically target ACE editor for Source Code Pro */
    .ace_editor,
    .ace_text-input,
    .ace_editor div,
    .ace_line,
    .ace_content {
      font-family: "Source Code Pro", monospace !important;
    }

    body {
      background-color: var(--bg-dark);
      color: var(--text-light);
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
        Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
      margin: 0;
      padding: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* Header styles */
    header {
      background-color: var(--bg-medium);
      border-bottom: 1px solid var(--border-color);
      padding: 0 0.75rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      height: 50px;
      z-index: 10;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    .header-center {
      display: flex;
      gap: 0.75rem;
      transform: translateX(-110px);
      /* Move left by 10 pixels; adjust as needed */
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 1.25rem;
    }

    .problem-list-btn {
      display: flex;
      align-items: center;
      color: var(--text-light);
      text-decoration: none;
      font-size: 0.95rem;
      padding: 8px 12px;
      border-radius: 6px;
      font-family: var(--font-primary);
      transition: background-color var(--transition-speed),
        box-shadow var(--transition-speed), transform var(--transition-speed);
    }

    .problem-list-btn:hover {
      background-color: var(--bg-light);
      box-shadow: var(--btn-shadow-hover);
      transform: translateY(-1px);
      text-decoration: none;
    }

    .nav-buttons {
      display: flex;
      gap: 0.75rem;
    }

    .nav-btn {
      font-family: var(--font-primary);
      background-color: var(--bg-light);
      border: 1px solid var(--border-color);
      color: var(--text-light);
      width: 36px;
      height: 36px;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: transform var(--transition-speed),
        box-shadow var(--transition-speed),
        background-color var(--transition-speed);
    }

    .nav-btn:hover {
      background-color: #3a3a3a;
      box-shadow: var(--btn-shadow-hover);
      transform: translateY(-2px);
    }

    .action-buttons {
      display: flex;
      gap: 0.9rem;
    }

    .btn-run,
    .btn-submit {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0.5rem 0.9rem;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
      font-size: 0.9rem;
      border: none;
      font-family: var(--font-primary);
      transition: transform var(--transition-speed),
        box-shadow var(--transition-speed);
      gap: 0.5rem;
    }

    .btn-run {
      background-color: #444;
      color: var(--text-light);
    }

    .btn-submit {
      background-color: var(--accent-yellow);
      color: #333;
    }

    .btn-run:hover,
    .btn-submit:hover {
      box-shadow: var(--btn-shadow-hover);
      transform: translateY(-2px);
    }

    .user-status {
      color: var(--text-light);
      text-decoration: none;
      font-size: 0.95rem;
      padding: 0.5rem;
    }

    /* Main content area */
    main {
      display: flex;
      flex: 1;
      overflow: hidden;
      position: relative;
      padding: 0.75rem;
      gap: 0.75rem;
      background-color: var(--bg-dark);
    }

    /* Split panels */
    .problem-section {
      width: 50%;
      display: flex;
      flex-direction: column;
      position: relative;
      background-color: var(--bg-medium);
      border-radius: 10px;
      box-shadow: var(--card-shadow);
      transition: box-shadow var(--transition-speed);
      overflow: hidden;
    }

    .problem-section:hover {
      box-shadow: var(--card-shadow-hover);
    }

    .editor-section {
      width: 50%;
      display: flex;
      flex-direction: column;
      position: relative;
      background-color: var(--bg-medium);
      border-radius: 10px;
      box-shadow: var(--card-shadow);
      transition: box-shadow var(--transition-speed);
      overflow: hidden;
    }

    .editor-section:hover {
      box-shadow: var(--card-shadow-hover);
    }

    /* Tabs styling */
    .tabs-container {
      display: flex;
      background-color: var(--bg-medium);
      padding: 0;
      overflow-x: auto;
      border-bottom: 0px solid var(--border-color);
    }

    .tab {
      padding: 0.7rem 1.4rem;
      cursor: pointer;
      color: var(--text-light);
      font-size: 0.89rem;
      font-weight: 50;
      letter-spacing: 0.02em;
      display: flex;
      align-items: center;
      gap: 9px;
      position: relative;
      white-space: nowrap;
      font-family: var(--font-primary);
      transition: background-color var(--transition-speed);
    }

    .tab:hover {
      background-color: var(--bg-light);
    }

    .tab.active {
      color: var(--accent-yellow);
    }

    .tab.active::after {
      content: "";
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 2px;
      background-color: var(--accent-yellow);
    }

    .tab-icon {
      font-size: 1rem;
      display: inline-flex;
      justify-content: center;
      align-items: center;
    }

    /* Problem content styles */
    .problem-content {
      overflow-y: auto;
      flex: 1;
      padding: 1.4rem;
      background-color: var(--bg-medium);
    }

    /* Card styling */
    .content-card {
      background-color: var(--bg-light);
      border-radius: 4px;
      padding: 0.9rem 1rem 0.7rem 1rem;
      margin-bottom: 1rem;
      box-shadow: var(--card-shadow);
      transition: box-shadow var(--transition-speed),
        transform var(--transition-speed);
    }

    .content-card:hover {
      box-shadow: var(--card-shadow-hover);
      transform: translateY(-2px);
    }

    .problem-title-card {
      display: flex;
      justify-content: space-between;
      align-items: start;
    }

    .problem-title {
      font-size: 1.5rem;
      font-weight: 500;
    }

    .difficulty-tag {
      font-size: 0.8rem;
      padding: 0.3rem 0.6rem;
      border-radius: 4px;
    }

    .easy {
      background-color: rgba(44, 187, 93, 0.2);
      color: #2cbb5d;
    }

    .medium {
      background-color: rgba(255, 192, 30, 0.2);
      color: #ffbf23;
    }

    .hard {
      background-color: rgba(239, 71, 67, 0.2);
      color: #ef4743;
    }

    .top-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background-color: #282828;
      padding: 14px 0px 12px 6px;
      height: 50px;
      border-bottom: 1px solid #444;
    }

    /* Example section */
    .section-title {
      font-size: 1.3rem;
      font-weight: 500;
      margin-bottom: 1rem;
      color: var(--text-light);
    }

    .example {
      background-color: var(--bg-dark);
      border-radius: 6px;
      padding: 1.4rem;
      margin-bottom: 1rem;
    }

    .example-row {
      margin-bottom: 0.75rem;
    }

    .example-label {
      font-weight: 500;
      margin-bottom: 0.35rem;
      color: var(--text-muted);
    }

    .example-content {
      font-family: var(--code-font);
      font-size: 0.95rem;
      padding: 12px;
    }

    /* Constraints */
    .constraints-list {
      list-style-type: disc;
      padding-left: 1.5rem;
      line-height: 1.6;
    }

    .constraints-list li {
      margin-bottom: 0.5rem;
    }

    /* Code editor area */
    .code-container {
      display: flex;
      flex-direction: column;
      flex: 1;
      position: relative;
    }

    .code-editor {
      flex: 1;
      position: relative;
      overflow: auto;
    }

    /* Line numbers and syntax highlighting */
    .line-numbers {
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 40px;
      background-color: var(--bg-dark);
      padding-top: 5px;
      font-family: var(--code-font);
      font-size: 0.9rem;
      color: var(--text-muted);
      text-align: right;
      user-select: none;
    }

    .line-number {
      padding-right: 0.5rem;
      height: 1.5rem;
    }

    .code-content {
      position: absolute;
      left: 40px;
      top: 0;
      bottom: 0;
      right: 0;
      padding: 5px 0 0 0.75rem;
      font-family: var(--code-font);
      color: var(--text-light);
      font-size: 0.95rem;
      white-space: pre;
      line-height: 1.5rem;
    }

    /* Resize handles */
    .resize-handle-horizontal {
      position: absolute;
      top: 0;
      bottom: 0;
      right: -5px;
      width: 10px;
      cursor: col-resize;
      z-index: 5;
    }

    /* Hide elements needed for JS */
    #answerSection,
    #codeSection,
    #answerTab,
    #codeTab,
    .solution-tabs,
    .tab-content:not(.active) {
      display: none;
    }

    /* Spinner for loading */
    .spinner {
      display: none;
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 50%;
      border-top-color: var(--text-light);
      animation: spin 1s ease-in-out infinite;
    }

    /* Status bar */
    .status-bar {
      height: 30px;
      background-color: var(--bg-medium);
      border-top: 1px solid var(--border-color);
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 1.2rem;
      color: var(--text-muted);
      font-size: 0.85rem;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    #aceEditorContainer {
      /* Reset all inherited styles */
      all: initial;

      /* Set only required properties */
      display: block;
      width: 100%;
      height: 100%;
    }

    /* Ensure ACE editor has proper dimensions */
    #codeEditor {
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      font-family: "Source Code Pro", monospace !important;
    }

    /* Set font for the Ace editor specifically */
    .ace_editor {
      font-family: "Source Code Pro", monospace !important;
      font-size: 14px !important;
    }

    /* Additional styling to ensure Source Code Pro is applied everywhere in the editor */
    .ace_editor,
    .ace_editor * {
      font-family: "Source Code Pro", monospace !important;
    }

    /* Problem image container */
    .problem-image-container {
      text-align: center;
      margin: 1.5rem 0;
    }

    .problem-image-container img {
      max-width: 100%;
      border-radius: 4px;
      border: 1px solid var(--border-color);
    }
  </style>
</head>

<body>
  <!-- Header with navigation and action buttons -->
  <header>
    <div class="header-left">
      <a href="home.html">
        <img src="images/bananaprep_logo.png" alt="BananaPrep Logo" class="logo-image top-nav" />
      </a>
      <a href="database.html" class="problem-list-btn">
        <span>☰ Problem List</span>
      </a>
      <div class="nav-buttons">
        <button class="nav-btn" id="prevProblemBtn" title="Previous Problem">
          <i class="fas fa-chevron-left"></i>
        </button>
        <button class="nav-btn" id="nextProblemBtn" title="Next Problem">
          <i class="fas fa-chevron-right"></i>
        </button>
      </div>
    </div>
    <div class="header-center">
      <div class="action-buttons">
        <button id="runBtn" class="btn-run">
          <span id="runSpinner" class="spinner"></span>
          <i class="fas fa-play"></i>
          <span>Run</span>
        </button>
        <button id="submitBtn" class="btn-submit">
          <span id="submitSpinner" class="spinner"></span>
          <i class="fas fa-check"></i>
          <span>Submit</span>
        </button>
      </div>
    </div>
    <div class="header-right">
      <span class="user-status" id="problemStatus">Unsolved</span>
      <div id="userAccountSection">
        <a href="login.html" class="user-status">Sign in</a>
      </div>
    </div>
  </header>

  <!-- Main content area -->
  <main>
    <!-- Left Panel: Problem Description -->
    <div class="problem-section">
      <div class="tabs-container">
        <div class="tab active">
          <i class="tab-icon fas fa-file-alt"></i>
          <span>Description</span>
        </div>
        <div class="tab">
          <i class="tab-icon fas fa-pen-nib"></i>
          <span>Editorial</span>
        </div>
        <div class="tab">
          <i class="tab-icon fas fa-comments"></i>
          <span>Solutions</span>
        </div>
      </div>

      <div class="problem-content" id="problemContent">
        <div class="content-card">
          <div class="problem-title-card">
            <span class="problem-title" id="problemTitle">Loading problem...</span>
            <span class="difficulty-tag" id="difficultyTag">Easy</span>
          </div>
          <div class="problem-description" id="problemDescription">
            Loading problem description...
          </div>
        </div>

        <!-- Problem Image Container (will be populated by JavaScript) -->
        <div class="problem-image-container" id="problemImageContainer">
          <!-- Image will be added here by JavaScript if available -->
        </div>

        <div class="content-card examples-section">
          <div class="section-title">Examples</div>
          <div id="problemExamples">
            <!-- Examples will be generated by JavaScript -->
            <div class="example">
              <div class="example-row">
                <div class="example-label">Loading examples...</div>
              </div>
            </div>
          </div>
        </div>

        <div class="content-card constraints-section">
          <div class="section-title">Constraints</div>
          <ul class="constraints-list" id="problemConstraints">
            <li>Loading constraints...</li>
          </ul>
        </div>
      </div>

      <!-- Resize handle for horizontal adjustment -->
      <div class="resize-handle-horizontal" id="horizontalResizeHandle"></div>
    </div>

    <!-- Right Panel: Code Editor -->
    <div class="editor-section">
      <div class="tabs-container">
        <div class="tab active">
          <i class="tab-icon fas fa-code"></i>
          <span>Code</span>
        </div>
        <div class="tab">
          <i class="tab-icon fas fa-vial"></i>
          <span>Testcase</span>
        </div>
      </div>

      <div class="code-container">
        <!-- Custom code editor display that resembles the image -->
        <div id="codeEditor" class="code-editor"></div>
      </div>
    </div>
  </main>

  <!-- Status bar -->
  <div class="status-bar">
    <div class="status-left">Ln 1, Col 1</div>
    <div class="status-right">BananaPrep © 2025</div>
  </div>

  <!-- Hidden elements preserved for JavaScript functionality -->
  <div id="authPrompt" style="display: none"></div>
  <div class="solution-tabs">
    <div class="tab" id="answerTab"></div>
    <div class="tab" id="codeTab"></div>
  </div>
  <div class="tab-content" id="answerSection"></div>
  <div class="tab-content" id="codeSection"></div>

  <!-- Alert messages -->
  <div class="alert alert-danger" id="errorAlert"></div>
  <div class="alert alert-success" id="successAlert"></div>

  <!-- Scripts -->
  <script src="js/api.js"></script>
  <script src="js/auth.js"></script>
  <script src="js/problem.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.12/ace.js" type="text/javascript"
    charset="utf-8"></script>
  <script src="js/ace-init.js"></script>
  <!-- Additional script to integrate problem navigation, resizing, and our new loading mechanism -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      // Navigation: Get current problem ID from URL
      function getCurrentProblemId() {
        const urlParams = new URLSearchParams(window.location.search);
        const id = urlParams.get("id");
        return id ? parseInt(id, 10) : 0; // Default to 0 if no ID is present
      }

      function navigateToProblem(id) {
        // Ensure ID is non-negative
        id = Math.max(0, id);
        window.location.href = `problem.html?id=${id}`;
      }

      // Set up problem navigation buttons
      const prevProblemBtn = document.getElementById("prevProblemBtn");
      const nextProblemBtn = document.getElementById("nextProblemBtn");

      if (prevProblemBtn) {
        prevProblemBtn.addEventListener("click", function () {
          const currentId = getCurrentProblemId();
          if (currentId > 0) {
            navigateToProblem(currentId - 1);
          }
        });
      }
      if (nextProblemBtn) {
        nextProblemBtn.addEventListener("click", function () {
          const currentId = getCurrentProblemId();
          navigateToProblem(currentId + 1);
        });
      }

      // Update auth prompt based on login status
      function updateAuthPrompt() {
        const authPrompt = document.getElementById("authPrompt");
        if (authPrompt) {
          authPrompt.style.display = localStorage.getItem("BananaPrepToken")
            ? "none"
            : "block";
        }
      }
      updateAuthPrompt();

      // Tab functionality (for code, editorial, etc.)
      document.querySelectorAll(".tab").forEach((tab) => {
        tab.addEventListener("click", function () {
          const siblings = Array.from(this.parentNode.children);
          siblings.forEach((sibling) => sibling.classList.remove("active"));
          this.classList.add("active");
        });
      });

      // Horizontal resize functionality
      const horizontalResizeHandle = document.getElementById(
        "horizontalResizeHandle"
      );
      if (horizontalResizeHandle) {
        horizontalResizeHandle.addEventListener("mousedown", function (e) {
          e.preventDefault();
          document.addEventListener("mousemove", resizeHorizontal);
          document.addEventListener("mouseup", stopResize);
        });
      }

      function resizeHorizontal(e) {
        const container = document.querySelector("main");
        const leftPanel = document.querySelector(".problem-section");
        const rightPanel = document.querySelector(".editor-section");
        if (!container || !leftPanel || !rightPanel) return;
        const containerWidth = container.clientWidth;
        const percentage = (e.clientX / containerWidth) * 100;
        if (percentage > 15 && percentage < 85) {
          leftPanel.style.width = percentage + "%";
          rightPanel.style.width = 100 - percentage + "%";
        }
      }

      // Vertical resize functionality
      const verticalResizeHandle = document.getElementById(
        "verticalResizeHandle"
      );
      if (verticalResizeHandle) {
        verticalResizeHandle.addEventListener("mousedown", function (e) {
          e.preventDefault();
          document.addEventListener("mousemove", resizeVertical);
          document.addEventListener("mouseup", stopResize);
        });
      }

      function stopResize() {
        document.removeEventListener("mousemove", resizeHorizontal);
        document.removeEventListener("mousemove", resizeVertical);
      }

      // --- NEW: Problem Loading Mechanism ---
      // Display error on the problem content area
      function displayError(title, error) {
        const problemContent = document.getElementById("problemContent");
        problemContent.innerHTML = `
            <h3 style="color: red;">${title}</h3>
            <p style="color: red;">${error.message}</p>
            <pre>${error.stack}</pre>
          `;
      }

      // Update the UI with problem details
      function updateProblemUI(problem) {
        document.getElementById("problemTitle").textContent =
          problem.title || "Untitled Problem";
        document.getElementById("problemDescription").innerHTML =
          problem.description || "No description available.";
        document.getElementById("difficultyTag").textContent =
          problem.difficulty || "Easy";

        // Update examples
        const problemExamples =
          document.getElementById("problemExamples");
        problemExamples.innerHTML = "";
        if (Array.isArray(problem.examples)) {
          problem.examples.forEach((example) => {
            const exDiv = document.createElement("div");
            exDiv.className = "example";
            exDiv.innerHTML = `
                <div class="example-row">
                  <div class="example-label"><strong>Input:</strong> ${example.input}</div>
                  <div class="example-label"><strong>Output:</strong> ${example.output}</div>
                </div>
              `;
            problemExamples.appendChild(exDiv);
          });
        } else {
          problemExamples.innerHTML = "<p>No examples available.</p>";
        }

        // Update constraints
        const constraintsList = document.getElementById("problemConstraints");
        constraintsList.innerHTML = "";
        if (Array.isArray(problem.constraints)) {
          problem.constraints.forEach((constraint) => {
            const li = document.createElement("li");
            li.textContent = constraint;
            constraintsList.appendChild(li);
          });
        } else {
          constraintsList.innerHTML = "<li>No constraints provided.</li>";
        }

        // Update image if available
        const imageContainer = document.getElementById(
          "problemImageContainer"
        );
        imageContainer.innerHTML = "";
        // if (problem.image) {
        //   const img = document.createElement("img");
        //   img.src = problem.image;
        //   img.alt = problem.title;
        //   imageContainer.appendChild(img);
        // }
      }

      const runBtn = document.getElementById("runBtn");

      if (runBtn) {
        runBtn.addEventListener("click", function () {
          console.log("Run button clicked!");
          // Defensive check: is the code editor even loaded?
          const codeEditor = document.getElementById("codeEditor");
          let code = "your code here";
          const simulatedOutput = `Output: ${code ? "Hello, World!" : "No code provided"}`;
        });
      } else {
        console.error("Run button or output element not found. Check your DOM!");
      }

      // Load problem details with fallback
      async function loadProblemDetails() {
        const urlParams = new URLSearchParams(window.location.search);
        const idParam = urlParams.get("id");
        const problemId = idParam ? parseInt(idParam, 10) : 0;

        try {
          const response = await fetch("/data/problems.json");
          if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
          }
          const problems = await response.json();
          if (problems.length === 0 || !problems[problemId]) {
            throw new Error(
              "No problems found or problem missing in primary source"
            );
          }
          const problem = problems[problemId];
          updateProblemUI(problem);
        } catch (error) {
          console.error(
            "Error loading problem details from primary source:",
            error
          );
          try {
            const altResponse = await fetch(
              "/server/public/data/problems.json"
            );
            if (!altResponse.ok) {
              throw new Error(`HTTP error! Status: ${altResponse.status}`);
            }
            const altProblems = await altResponse.json();
            if (altProblems.length === 0 || !altProblems[problemId]) {
              throw new Error(
                "No problems found or problem missing in alternate source"
              );
            }
            const problem = altProblems[problemId];
            updateProblemUI(problem);
          } catch (altError) {
            console.error(
              "Error loading problem details from both sources:",
              altError
            );
            displayError("Error loading problem details", {
              message: "Failed to load problem from both locations",
              stack: `Primary: ${error.message}\nAlternate: ${altError.message}`,
            });
          }
        }
      }

      // Trigger loading of the problem details
      loadProblemDetails();
      // --- End of Problem Loading Mechanism ---
    });
  </script>
</body>

</html>